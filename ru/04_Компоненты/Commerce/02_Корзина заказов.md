
Корзина вызывается на всех страницах, где необходима работа магазина -- добавление, редактирование и удаление товаров.

**Совет:** корзина - это обёртка для сниппета DocLister и в ней работают практически все его параметры.

**Как это может пригодиться?**
Скажем, вы хотите показывать в корзине фотографию товара. Пускай она хранится в ТВ с именем `mainphoto`. Как и в DocLister, вам необходимо при помощи параметра `&tvList=mainphoto` указать сниппету, что в выборку включается ТВ.

## Пример вызова ##

```
[!Cart
    &instance=`products`
    &theme=``
    &tpl=`cartRowTpl`
    &optionsTpl=`cartOptionsTpl`
    &ownerTPL=`cartOwnerTPL`
    &subtotalsRowTpl=`cartSubtotalsRowTpl`
    &subtotalsTpl=`cartSubtotalsTpl`
!]
```
## Параметры ##

<table>
	<tr>
		<th>Параметр</th>
		<th>Описание</th>
	</tr><tr>
		<td>instance</td>
		<td>
			<p>Тип корзины.</p>
			<p>С помощью сниппета можно вывести корзину с товарами, либо списки избранного или сравнения. Соответственно, значение может быть <code>products</code>, <code>wishlist</code> или <code>comparison</code>.</p>
			<p>Данные значения предустановлены. Если нужны другие списки, их можно создать в плагине на событие <code>OnInitializeCommerce</code>:</p>
			<pre>
ci()->carts->addCart(new \Commerce\Carts\ProductsList($modx, 'listname'));
			</pre>
		</td>
	</tr><tr>
		<td>theme</td>
		<td>
			<p>Префикс имени шаблонов.</p>
			<p>По умолчанию пустое значение. Можно использовать для темизации корзины, чтобы не указывать все шаблоны по отдельности. Может быть либо префиксом имен файлов, либо именем вложенной папки (тогда в конце нужно указать слэш).</p>
			<p>Изначально доступны шаблоны без префикса и с префиксом "mini", например minicart_wrap и пр. - для миникорзины.</p></td>
	</tr><tr>
		<td>tpl</td>
		<td><p>Шаблон строки корзины, соответствует такому же параметру DocLister</p><p>Помимо стандартных, в шаблоне доступны следующие плейсхолдеры:<br><code>[+original_title+]</code> - название товара из таблицы site_content,<br><code>[+hash+]</code> - хэш-код строки,<br><code>[+count+]</code> - количество данного товара,<br><code>[+price+]</code> - цена товара,<br><code>[+total+]</code> - полная стоимость данного товара,<br><code>[+options+]</code> - опции товара (обработанные или нет, зависит от параметра defaultOptionsRender).</p></td>
	</tr><tr>
		<td>ownerTPL</td>
		<td><p>Шаблон обертки корзины, соответствует такому же параметру DocLister</p><p>Помимо стандартных, в шаблоне доступны следующие плейсхолдеры:<br><code>[+hash+]</code> - хэш-код козины,<br><code>[+items_price+]</code> - суммарная стоимость товаров,<br><code>[+total+]</code> - полная стоимость корзины, с учетом дополнительных сборов,<br><code>[+subtotals+]</code> - дополнительные сборы,<br><code>[+count+]</code> - число товаров в корзине,<br><code>[+rows_count+]</code> - число строк в корзине,<br><code>[+settings+]</code> - массив настроек плагина Commerce.</p></td>
	</tr><tr>
		<td>optionsTpl</td>
		<td><p>Шаблон строки опций товара. Имеет смысл только при &defaultOptionsRender=`1`. Подразумевается, что опции товара заданы как массив пар ключ => значение.</p><p>В шаблоне доступны следующие значения:<br><code>[+key+]</code> - ключ,<br><code>[+option+]</code> - значение опции.</p></td>
	</tr><tr>
		<td>defaultOptionsRender</td>
		<td><p>Нужно ли рендерить опции товара. Принимает значения 0 или 1, по умолчанию - 1.</p><p>Если структура опций имеет более сложный формат, можно поставить значение 0, а опции обрабатывать в prepare.</p></td>
	</tr><tr>
		<td>subtotalsTpl</td>
		<td><p>Шаблон обертки для дополнительных сборов.</p></td>
	</tr><tr>
		<td>subtotalsRowTpl</td>
		<td><p>Шаблон строки дополнительных сборов.</p><p>Доступные следующие плейсхолдеры:<br><code>[+title+]</code> - название,<br><code>[+price+]</code> - цена.</p></td>
	</tr><tr>
		<td>prepareSubtotalsWrap</td>
		<td><p>prepare для обертки дополнительных сборов, действие аналогично параметру prepareWrap</p></td>
	</tr><tr>
		<td>prepareSubtotalsRow</td>
		<td><p>prepare для строк дополнительных сборов, действие аналогично параметру prepare</p></td>
	</tr>
</table>

Остальные параметры абсолютно аналогичны таковым в сниппете DocLister.

## Примеры чанков ##
Больше примеров вы можете найти в папке:
```
assets/plugins/commerce/templates/front/
```

### ownerTPL ###

Шаблон обёртки корзины

```
<div data-commerce-cart="[+hash+]">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <td colspan="2">[%cart.item_title%]</td>
                    <td>[%cart.count%]</td>
                    <td class="text-xs-right">[%cart.item_price%]</td>
                </tr>
            </thead>

            <tfoot>
                [+subtotals+]
                <tr>
                    <td class="text-xs-right" colspan="4">[%cart.total%]:</td>
                    <td class="text-xs-right">[[PriceFormat? &price=`[+total+]` &convert=`0`]]</td>
                </tr>
            </tfoot>

            <tbody>
                [[if? &is=`[+count+]:>:0` &then=`
                    [+dl.wrap+]
                ` &else=`
                    <tr>
                        <td colspan="3" class="text-xs-center">
                            [%cart.no_items%]
                    </tr>
                `]]
            </tbody>
        </table>
    </div>

    [[if? &is=`[+count+]:>:0` &then=`
        <div class="text-xs-right">
            <p><a href="[~28~]">[%cart.to_checkout%]</a></p>
        </div>
    `]]
</div>
```
**Совет:** для вывода различных шаблонов пустой или полной корзины вы можете воспользоваться любым сниппетом, который сможет проверить плейсхолдер `[+count+]`:
```
[[if? &is=`[+count+]:>:0` &then=`ШАБЛОН ПОЛНОЙ КОРЗИНЫ`
&else=`ШАБЛОН ПУСТОЙ КОРЗИНЫ`]]
```

### tpl ###

Шаблон одного товара в корзине
```
<tr data-id="[+id+]" data-commerce-row="[+row+]">
	<td>
		<img src="[[phpthumb? &input=`[+tv.mainphoto+]` &options=`w=80,h=80,zc=1,f=png`]]" class="img-fluid" alt="[+e.title+]">
	<td>
		<a href="[+url+]">[+name+]</a>
		<div class="small text-muted">
			[+options+]
		</div>
	<td>
		<input type="text" name="count" class="form-control" value="[+count+]" data-commerce-action="recount">
		<button type="button" data-commerce-action="decrease">-</button>
		<button type="button" data-commerce-action="increase">+</button>
		<button type="button" data-commerce-action="remove">x</button>

	<td class="text-xs-right">
		[!PriceFormat? &price=`[+price+]` &convert=`0`!]

	<td class="text-xs-right">
		[!PriceFormat? &price=`[+total+]` &convert=`0`!]
</tr>

```
Для того, чтобы корректно заработали кнопки действий, не забудьте каждому товару прописать атрибуты `data-id="[+id+]" data-commerce-row="[+row+]"` как указано в примере выше.

### subtotalsTpl ###

Обёртка для доп. опций типа "Доставка"
```
[+wrap+]

```

### subtotalsRowTpl ###

Один пункт в доп. опциях

```
<tr>
    <td class="text-xs-right" colspan="3">[+title+]:</td>
    <td class="text-xs-right" colspan="1">[[PriceFormat? &price=`[+price+]` &convert=`0`]]</td>
</tr>

```
